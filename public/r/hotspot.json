{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "hotspot",
  "type": "registry:component",
  "title": "Image Hotspot",
  "description": "Click labelled markers on a diagram or photo, type the answer in a popover, check all labels at once.",
  "registryDependencies": [
    "button",
    "badge",
    "input",
    "progress",
    "popover"
  ],
  "files": [
    {
      "path": "registry/default/hotspot/hotspot.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { useState, useCallback } from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Input } from \"@/components/ui/input\"\nimport { Progress } from \"@/components/ui/progress\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { CheckCircle2, XCircle, ChevronRight } from \"lucide-react\"\n\n// ─── Types ────────────────────────────────────────────────────────────────────\n\nexport interface HotspotPoint {\n  id: string\n  /** Percentage from left edge (0–100) */\n  x: number\n  /** Percentage from top edge (0–100) */\n  y: number\n  /** The correct label the learner must type */\n  label: string\n  /** Optional description shown after a correct match */\n  description?: string\n}\n\nexport interface HotspotQuestion {\n  id: string\n  imageUrl: string\n  imageAlt: string\n  prompt: string\n  points: HotspotPoint[]\n  /** Case-sensitive matching (default: false) */\n  caseSensitive?: boolean\n}\n\nexport interface HotspotData {\n  title: string\n  description?: string\n  questions: HotspotQuestion[]\n}\n\nexport interface HotspotAttempt {\n  questionId: string\n  /** Map of pointId → typed answer */\n  answers: Record<string, string>\n  score: number\n  maxScore: number\n}\n\nexport interface HotspotResult {\n  attempts: HotspotAttempt[]\n  totalScore: number\n  maxScore: number\n  percentage: number\n}\n\nexport interface HotspotProps {\n  hotspotData: HotspotData\n  onComplete?: (result: HotspotResult) => void\n  className?: string\n}\n\n// ─── Helpers ──────────────────────────────────────────────────────────────────\n\nfunction isLabelCorrect(\n  given: string,\n  correct: string,\n  caseSensitive: boolean\n): boolean {\n  const norm = (s: string) =>\n    caseSensitive ? s.trim() : s.trim().toLowerCase()\n  return norm(given) === norm(correct)\n}\n\n// ─── Component ────────────────────────────────────────────────────────────────\n\nexport function Hotspot({ hotspotData, onComplete, className }: HotspotProps) {\n  const { title, description, questions } = hotspotData\n\n  const [index, setIndex] = useState(0)\n  const [inputs, setInputs] = useState<Record<string, string>>({})\n  const [submitted, setSubmitted] = useState(false)\n  const [attempts, setAttempts] = useState<HotspotAttempt[]>([])\n  const [finished, setFinished] = useState(false)\n  const [openPopover, setOpenPopover] = useState<string | null>(null)\n\n  const question = questions[index]\n  const progress = (index / questions.length) * 100\n\n  React.useEffect(() => {\n    setInputs({})\n    setSubmitted(false)\n    setOpenPopover(null)\n  }, [index])\n\n  const checkPoint = useCallback(\n    (pointId: string): boolean => {\n      const point = question.points.find((p) => p.id === pointId)\n      if (!point) return false\n      return isLabelCorrect(\n        inputs[pointId] ?? \"\",\n        point.label,\n        question.caseSensitive ?? false\n      )\n    },\n    [question, inputs]\n  )\n\n  const handleNext = useCallback(() => {\n    const correctCount = question.points.filter((p) =>\n      checkPoint(p.id)\n    ).length\n    const attempt: HotspotAttempt = {\n      questionId: question.id,\n      answers: inputs,\n      score: correctCount,\n      maxScore: question.points.length,\n    }\n    const newAttempts = [...attempts, attempt]\n    setAttempts(newAttempts)\n\n    if (index + 1 >= questions.length) {\n      const totalScore = newAttempts.reduce((s, a) => s + a.score, 0)\n      const maxScore = newAttempts.reduce((s, a) => s + a.maxScore, 0)\n      const res: HotspotResult = {\n        attempts: newAttempts,\n        totalScore,\n        maxScore,\n        percentage: Math.round((totalScore / maxScore) * 100),\n      }\n      setFinished(true)\n      onComplete?.(res)\n    } else {\n      setIndex((i) => i + 1)\n    }\n  }, [\n    question,\n    inputs,\n    checkPoint,\n    attempts,\n    index,\n    questions.length,\n    onComplete,\n  ])\n\n  // ── Finished ──────────────────────────────────────────────────────────────\n  if (finished) {\n    const totalScore = attempts.reduce((s, a) => s + a.score, 0)\n    const maxScore = attempts.reduce((s, a) => s + a.maxScore, 0)\n    const pct = Math.round((totalScore / maxScore) * 100)\n    return (\n      <div\n        className={cn(\n          \"w-full max-w-2xl mx-auto text-center space-y-4\",\n          className\n        )}\n      >\n        <h2 className=\"text-2xl font-bold\">Done!</h2>\n        <p className=\"text-5xl font-bold\">{pct}%</p>\n        <p className=\"text-muted-foreground\">\n          {totalScore} / {maxScore} labels correct\n        </p>\n      </div>\n    )\n  }\n\n  return (\n    <div className={cn(\"w-full max-w-2xl mx-auto space-y-4\", className)}>\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"font-semibold text-lg\">{title}</h2>\n          {description && (\n            <p className=\"text-sm text-muted-foreground\">{description}</p>\n          )}\n        </div>\n        <Badge variant=\"outline\">\n          {index + 1} / {questions.length}\n        </Badge>\n      </div>\n\n      <Progress value={progress} className=\"h-1.5\" />\n\n      <p className=\"font-medium\">{question.prompt}</p>\n\n      {/* Image with hotspot markers */}\n      <div className=\"relative w-full rounded-xl overflow-hidden border select-none\">\n        <img\n          src={question.imageUrl}\n          alt={question.imageAlt}\n          className=\"w-full h-auto object-cover\"\n          draggable={false}\n        />\n\n        {question.points.map((point) => {\n          const isOpen = openPopover === point.id\n          const correct = submitted ? checkPoint(point.id) : undefined\n\n          return (\n            <Popover\n              key={point.id}\n              open={isOpen}\n              onOpenChange={(open) =>\n                setOpenPopover(open ? point.id : null)\n              }\n            >\n              <PopoverTrigger asChild>\n                <button\n                  style={{\n                    left: `${point.x}%`,\n                    top: `${point.y}%`,\n                    position: \"absolute\",\n                  }}\n                  className={cn(\n                    \"-translate-x-1/2 -translate-y-1/2 size-7 rounded-full border-2 border-white shadow-lg flex items-center justify-center text-white text-xs font-bold transition-all\",\n                    submitted && correct && \"bg-green-500\",\n                    submitted && !correct && \"bg-destructive\",\n                    !submitted && \"bg-primary hover:scale-110\"\n                  )}\n                  aria-label={`Label point ${point.id}`}\n                >\n                  {submitted && correct && (\n                    <CheckCircle2 className=\"size-4\" />\n                  )}\n                  {submitted && !correct && (\n                    <XCircle className=\"size-4\" />\n                  )}\n                  {!submitted && \"+\"}\n                </button>\n              </PopoverTrigger>\n              <PopoverContent className=\"w-60 space-y-2\" side=\"top\">\n                {!submitted ? (\n                  <Input\n                    placeholder=\"Type label…\"\n                    value={inputs[point.id] ?? \"\"}\n                    onChange={(e) =>\n                      setInputs((prev) => ({\n                        ...prev,\n                        [point.id]: e.target.value,\n                      }))\n                    }\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\")\n                        setOpenPopover(null)\n                    }}\n                    autoFocus\n                  />\n                ) : (\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center gap-2 text-sm font-medium\">\n                      {correct ? (\n                        <CheckCircle2 className=\"size-4 text-green-600\" />\n                      ) : (\n                        <XCircle className=\"size-4 text-destructive\" />\n                      )}\n                      {correct\n                        ? \"Correct!\"\n                        : `Answer: ${point.label}`}\n                    </div>\n                    {point.description && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {point.description}\n                      </p>\n                    )}\n                    {!correct && inputs[point.id] && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        You said: {inputs[point.id]}\n                      </p>\n                    )}\n                  </div>\n                )}\n              </PopoverContent>\n            </Popover>\n          )\n        })}\n      </div>\n\n      <p className=\"text-xs text-muted-foreground\">\n        Click each marker (+) to label it.{\" \"}\n        {question.points.length} label\n        {question.points.length > 1 ? \"s\" : \"\"} total.\n      </p>\n\n      <div className=\"flex justify-end\">\n        {!submitted ? (\n          <Button onClick={() => setSubmitted(true)}>\n            Check Labels\n          </Button>\n        ) : (\n          <Button onClick={handleNext}>\n            {index + 1 >= questions.length ? \"See Results\" : \"Next\"}\n            <ChevronRight className=\"ml-1 size-4\" />\n          </Button>\n        )}\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    }
  ]
}