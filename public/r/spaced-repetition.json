{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "spaced-repetition",
  "type": "registry:component",
  "title": "Spaced Repetition",
  "description": "SM-2 algorithm review session: flip cards, grade with Again/Hard/Good/Easy, computes next interval and ease factor.",
  "registryDependencies": [
    "button",
    "badge",
    "card",
    "progress"
  ],
  "files": [
    {
      "path": "registry/default/spaced-repetition/spaced-repetition.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { useState, useCallback } from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { Brain, RotateCcw, CheckCircle2 } from \"lucide-react\"\n\n// ─── Types ────────────────────────────────────────────────────────────────────\n\n/**\n * SM-2 response quality:\n * 0 = complete blackout\n * 1 = incorrect; correct answer recalled\n * 2 = incorrect; easy recall after seeing answer\n * 3 = correct with serious difficulty\n * 4 = correct after hesitation\n * 5 = perfect response\n */\nexport type ReviewGrade = 0 | 1 | 2 | 3 | 4 | 5\n\nexport interface ReviewCard {\n  id: string\n  front: string\n  back: string\n  tags?: string[]\n  /** ISO date string — next scheduled review */\n  nextReviewDate?: string\n  /** Current review interval in days */\n  interval?: number\n  /** SM-2 ease factor (default: 2.5) */\n  easeFactor?: number\n}\n\nexport interface SpacedRepetitionData {\n  title: string\n  description?: string\n  /** Cards due for review in this session */\n  dueCards: ReviewCard[]\n  /** Total cards in the deck (for display) */\n  totalCards?: number\n}\n\nexport interface ReviewSession {\n  cardId: string\n  grade: ReviewGrade\n  /** Computed next interval in days */\n  nextInterval: number\n  /** Updated ease factor */\n  nextEaseFactor: number\n}\n\nexport interface SpacedRepetitionResult {\n  sessions: ReviewSession[]\n  /** IDs of cards graded < 3 (need re-study) */\n  hardCardIds: string[]\n}\n\nexport interface SpacedRepetitionProps {\n  spacedRepetitionData: SpacedRepetitionData\n  onComplete?: (result: SpacedRepetitionResult) => void\n  className?: string\n}\n\n// ─── SM-2 Algorithm ───────────────────────────────────────────────────────────\n\nfunction sm2(\n  grade: ReviewGrade,\n  prevInterval: number,\n  easeFactor: number\n): { interval: number; easeFactor: number } {\n  if (grade < 3) {\n    return { interval: 1, easeFactor: Math.max(1.3, easeFactor - 0.2) }\n  }\n  let interval: number\n  if (prevInterval === 0) interval = 1\n  else if (prevInterval === 1) interval = 6\n  else interval = Math.round(prevInterval * easeFactor)\n\n  const newEase = Math.max(\n    1.3,\n    easeFactor + 0.1 - (5 - grade) * (0.08 + (5 - grade) * 0.02)\n  )\n  return { interval, easeFactor: newEase }\n}\n\n// ─── Grade buttons ────────────────────────────────────────────────────────────\n\ninterface GradeButton {\n  grade: ReviewGrade\n  label: string\n  description: string\n  variant: \"destructive\" | \"outline\" | \"secondary\" | \"default\"\n}\n\nconst GRADE_BUTTONS: GradeButton[] = [\n  {\n    grade: 1,\n    label: \"Again\",\n    description: \"Complete blackout\",\n    variant: \"destructive\",\n  },\n  {\n    grade: 2,\n    label: \"Hard\",\n    description: \"Difficult recall\",\n    variant: \"outline\",\n  },\n  {\n    grade: 3,\n    label: \"Good\",\n    description: \"Correct with effort\",\n    variant: \"secondary\",\n  },\n  {\n    grade: 4,\n    label: \"Easy\",\n    description: \"Recalled easily\",\n    variant: \"default\",\n  },\n]\n\n// ─── Component ────────────────────────────────────────────────────────────────\n\nexport function SpacedRepetition({\n  spacedRepetitionData,\n  onComplete,\n  className,\n}: SpacedRepetitionProps) {\n  const { title, description, dueCards, totalCards } =\n    spacedRepetitionData\n\n  const [index, setIndex] = useState(0)\n  const [flipped, setFlipped] = useState(false)\n  const [sessions, setSessions] = useState<ReviewSession[]>([])\n  const [finished, setFinished] = useState(false)\n\n  const card = dueCards[index]\n  const progress = (index / dueCards.length) * 100\n\n  const handleGrade = useCallback(\n    (grade: ReviewGrade) => {\n      const prev = card.interval ?? 0\n      const ease = card.easeFactor ?? 2.5\n      const { interval, easeFactor } = sm2(grade, prev, ease)\n\n      const newSessions: ReviewSession[] = [\n        ...sessions,\n        {\n          cardId: card.id,\n          grade,\n          nextInterval: interval,\n          nextEaseFactor: easeFactor,\n        },\n      ]\n      setSessions(newSessions)\n\n      if (index + 1 >= dueCards.length) {\n        const hardCardIds = newSessions\n          .filter((s) => s.grade < 3)\n          .map((s) => s.cardId)\n        setFinished(true)\n        onComplete?.({ sessions: newSessions, hardCardIds })\n      } else {\n        setIndex((i) => i + 1)\n        setFlipped(false)\n      }\n    },\n    [card, sessions, index, dueCards.length, onComplete]\n  )\n\n  // ── Finished ──────────────────────────────────────────────────────────────\n  if (finished) {\n    const hardCount = sessions.filter((s) => s.grade < 3).length\n    const easyCount = sessions.filter((s) => s.grade >= 4).length\n    const goodCount = sessions.length - hardCount - easyCount\n\n    return (\n      <div\n        className={cn(\n          \"w-full max-w-md mx-auto space-y-4\",\n          className\n        )}\n      >\n        <div className=\"text-center space-y-2\">\n          <Brain className=\"mx-auto size-12 text-primary\" />\n          <h2 className=\"text-2xl font-bold\">Review Complete!</h2>\n          <p className=\"text-muted-foreground\">\n            {dueCards.length} card\n            {dueCards.length > 1 ? \"s\" : \"\"} reviewed.\n          </p>\n        </div>\n        <div className=\"grid grid-cols-3 gap-3 text-center\">\n          <Card>\n            <CardContent className=\"pt-4\">\n              <p className=\"text-2xl font-bold text-destructive\">\n                {hardCount}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">Again / Hard</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4\">\n              <p className=\"text-2xl font-bold\">{goodCount}</p>\n              <p className=\"text-xs text-muted-foreground\">Good</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4\">\n              <p className=\"text-2xl font-bold text-green-600\">\n                {easyCount}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">Easy</p>\n            </CardContent>\n          </Card>\n        </div>\n        {totalCards !== undefined && (\n          <p className=\"text-center text-xs text-muted-foreground\">\n            {totalCards - dueCards.length} more cards not due today.\n          </p>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div\n      className={cn(\"w-full max-w-md mx-auto space-y-4\", className)}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"font-semibold text-lg\">{title}</h2>\n          {description && (\n            <p className=\"text-sm text-muted-foreground\">{description}</p>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {totalCards && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {totalCards} total\n            </Badge>\n          )}\n          <Badge variant=\"secondary\">\n            {dueCards.length - index} remaining\n          </Badge>\n        </div>\n      </div>\n\n      <Progress value={progress} className=\"h-1.5\" />\n\n      {/* 3-D flip card */}\n      <div\n        className=\"relative h-52 cursor-pointer select-none\"\n        style={{ perspective: \"1200px\" }}\n        onClick={() => setFlipped((f) => !f)}\n        role=\"button\"\n        aria-label={\n          flipped\n            ? \"Card answer — click to flip\"\n            : \"Card question — click to reveal\"\n        }\n        tabIndex={0}\n        onKeyDown={(e) =>\n          e.key === \"Enter\" && setFlipped((f) => !f)\n        }\n      >\n        <div\n          className=\"relative w-full h-full transition-transform duration-500\"\n          style={{\n            transformStyle: \"preserve-3d\",\n            transform: flipped ? \"rotateY(180deg)\" : \"rotateY(0deg)\",\n          }}\n        >\n          {/* Front */}\n          <div\n            className=\"absolute inset-0 rounded-xl border bg-card shadow flex flex-col items-center justify-center p-8 text-center\"\n            style={{ backfaceVisibility: \"hidden\" }}\n          >\n            <div className=\"flex items-center gap-1.5 mb-3 text-xs text-muted-foreground\">\n              <Brain className=\"size-3.5\" />\n              <span>Question</span>\n              {card.tags?.map((tag) => (\n                <Badge\n                  key={tag}\n                  variant=\"outline\"\n                  className=\"text-[10px] py-0\"\n                >\n                  {tag}\n                </Badge>\n              ))}\n            </div>\n            <p className=\"text-lg font-medium\">{card.front}</p>\n            <p className=\"mt-4 text-xs text-muted-foreground\">\n              Click to reveal\n            </p>\n          </div>\n\n          {/* Back */}\n          <div\n            className=\"absolute inset-0 rounded-xl border bg-primary/5 shadow flex flex-col items-center justify-center p-8 text-center\"\n            style={{\n              backfaceVisibility: \"hidden\",\n              transform: \"rotateY(180deg)\",\n            }}\n          >\n            <div className=\"flex items-center gap-1.5 mb-3 text-xs text-muted-foreground\">\n              <CheckCircle2 className=\"size-3.5 text-green-600\" />\n              <span>Answer</span>\n            </div>\n            <p className=\"text-lg\">{card.back}</p>\n            {card.interval !== undefined && (\n              <p className=\"mt-3 text-xs text-muted-foreground\">\n                Previous interval: {card.interval}d\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Grade buttons (only shown after flip) */}\n      {flipped ? (\n        <div className=\"space-y-1\">\n          <p className=\"text-xs text-center text-muted-foreground mb-2\">\n            How well did you remember?\n          </p>\n          <div className=\"grid grid-cols-4 gap-2\">\n            {GRADE_BUTTONS.map((gb) => (\n              <div key={gb.grade} className=\"flex flex-col gap-1\">\n                <Button\n                  variant={gb.variant}\n                  size=\"sm\"\n                  className=\"w-full\"\n                  onClick={() => handleGrade(gb.grade)}\n                >\n                  {gb.label}\n                </Button>\n                <p className=\"text-[10px] text-center text-muted-foreground leading-tight\">\n                  {gb.description}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex justify-center\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setFlipped(true)}\n          >\n            <RotateCcw className=\"mr-2 size-4\" />\n            Show Answer\n          </Button>\n        </div>\n      )}\n    </div>\n  )\n}\n",
      "type": "registry:component"
    }
  ]
}